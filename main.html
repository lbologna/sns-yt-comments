<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>sns-yt-comments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>

<body id="banner">
  <script>
    // Make sure the client is loaded before calling this method.
    async function execute() {

      const fetchResSNS = await fetch("https://lucaleonardobologna.it/snscomments/");
      const jsonDataSNS = await fetchResSNS.json();
      populate(jsonDataSNS, "1a");

      const fetchResSC = await fetch("https://lucaleonardobologna.it/sccomments/");
      const jsonDataSC = await fetchResSC.json();
      populate(jsonDataSC, "2a");

      const fetchResPGENG = await fetch("https://lucaleonardobologna.it/pgengcomments/");
      const jsonDataPGENG = await fetchResPGENG.json();
      populate(jsonDataPGENG, "3a");


      function populate(res, divId) {
        let mainSnSdiv = document.getElementById(divId);
        mainSnSdiv.innerHTML = "";
        mainSnSdiv.scrollTop = 0;

        // Handle the results here (response.result has the parsed body).
        res["items"].forEach(element => {
          /* container div */
          let cdiv = document.createElement("div");
          cdiv.classList.add("container");

          /* title row div */
          let titleDiv = document.createElement("div");
          titleDiv.classList.add("row", "border", "text-wrap");

          /* title content div */
          let videoID = element["snippet"]["topLevelComment"]["snippet"]["videoId"];
          let titleContentDiv = document.createElement("div");
          titleContentDiv.classList.add("col-12", "border");
          
          titleDiv.appendChild(titleContentDiv);
          cdiv.appendChild(titleDiv);

          /* row div */
          let rdiv = document.createElement("div");
          rdiv.classList.add("row", "border", "text-wrap");
          cdiv.appendChild(rdiv);

          /* comment div */
          let commentDiv = document.createElement("div");
          commentDiv.classList.add("col-10", "text-wrap");
          let comment = element["snippet"]["topLevelComment"]["snippet"]["textOriginal"];
          let author = element["snippet"]["topLevelComment"]["snippet"]["authorDisplayName"];
          let authorImage = element["snippet"]["topLevelComment"]["snippet"]["authorProfileImageUrl"];
          let linkToVideo = "<a href='https://www.youtube.com/watch?v=" + videoID + "' target=_blank>Apri in YT</a> - <a href='#banner'><i class='bi bi-arrow-up'></i><a>";
          let replies = element["snippet"]["totalReplyCount"];
          let repliesText = "<strong>Risposte:</strong> " + replies + " - "
          commentDiv.innerHTML = "<img width=20px src='" + authorImage + "''> <strong>" + author + "</strong><br>" + comment + "<br>" + repliesText + linkToVideo;
          rdiv.appendChild(commentDiv);

          /* date div */
          let dateDiv = document.createElement("div");
          dateDiv.classList.add("col-2", "text-wrap");
          let creationDateString = element["snippet"]["topLevelComment"]["snippet"]["updatedAt"];
          rdiv.appendChild(dateDiv);
          cdiv.scrollTop = 0;
          rdiv.scrollTop = 0;
          mainSnSdiv.appendChild(cdiv);

          let currentTime = new Date();
          let creationDate = new Date(creationDateString);

          textToDisplay = timeText(currentTime, creationDate);
          //To display the final no. of days (result)
          dateDiv.innerHTML = textToDisplay;
        });
      }
    }

    /* ------------ */

    function timeText(currentTime, creationDate) {
      // To calculate the time difference of two dates
      var DifferenceInTime = currentTime.getTime() - creationDate.getTime();

      // To calculate the no. of days between two dates
      let diffDays = DifferenceInTime / (1000 * 3600 * 24);
      let diffHours = diffDays * 24;
      let diffMinutes = diffHours * 60;
      let timeToDisplay = "";
      if (diffDays > 1) {
        let displayTime = Math.floor(diffDays);
        if (displayTime == 1)
          text = "g"
        else
          text = "g"
        timeToDisplay = displayTime + text;
      } else if (diffHours > 1) {
        let displayTime = Math.floor(diffHours);
        if (displayTime == 1)
          text = "h"
        else
          text = "h"
        timeToDisplay = displayTime + text;
      } else {
        let displayTime = Math.ceil(diffMinutes);
        if (displayTime == 1)
          text = "m"
        else
          text = "m"
        timeToDisplay = displayTime + text;
      }
      timeToDisplay = timeToDisplay;
      return timeToDisplay;
    }
  </script>

  <!-- Tab content -->
  <div id="exTab1" class=" ">
    <div id="" class="sticky-top container ">
      <ul class=" nav nav-pills nav-fill gap-2 p-1 small bg-primary rounded-5 shadow-sm" id="pillNav2" role="tablist"
        style="--bs-nav-link-color: var(--bs-white); --bs-nav-pills-link-active-color: var(--bs-primary); --bs-nav-pills-link-active-bg: var(--bs-white);">
        <li class="nav-item" role="presentation">
          <button href="#1a" class="nav-link active rounded-5" id="home-tab2" data-bs-toggle="tab" type="button"
            role="tab" aria-selected="true">SnS</button>
        </li>
        <li class="nav-item" role="presentation">
          <button href="#2a" class="nav-link rounded-5" id="profile-tab2" data-bs-toggle="tab" type="button" role="tab"
            aria-selected="false">Siate Curiosi</button>
        </li>
        <li class="nav-item" role="presentation">
          <button href="#3a" class="nav-link rounded-5" id="contact-tab2" data-bs-toggle="tab" type="button" role="tab"
            aria-selected="false">PG Eng</button>
        </li>
      </ul>
      <button onclick="execute()"
        style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem; margin-top:5px; margin-bottom:5px"
        type="button" class="container rounded-4 col-12 btn btn-secondary">
        Aggiorna
      </button>
    </div>

    <div class="row tab-content clearfix">
      <div class="tab-pane active" id="1a">
      </div>
      <div class="tab-pane" id="2a">
      </div>
      <div class="tab-pane" id="3a">
      </div>
    </div>
  </div>

  <!-- Tab content -->

  <!-- Bootstrap core JavaScript
    ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"
    integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa"
    crossorigin="anonymous"></script>
</body>
</html>
